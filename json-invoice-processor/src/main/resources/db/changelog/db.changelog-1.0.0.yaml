databaseChangeLog:
  - changeSet:
      id: 1
      author: ferrarim
      changes:
        - createTable:
            tableName: invoice_version
            columns:
              - column:
                  name: version
                  type: varchar(255)
                  constraints:
                    primaryKey: true
              - column:
                  name: validity_end_date
                  type: dateTime
              - column:
                  name: validity_start_date
                  type: dateTime
        - createTable:
            tableName: financial_institution
            columns:
              - column:
                  name: iban
                  type: varchar(255)
                  constraints:
                    primaryKey: true
              - column:
                  name: abi
                  type: varchar(50)
              - column:
                  name: bic
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: cab
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: name
                  type: varchar(255)
                  constraints:
                    nullable: false
        - createTable:
            tableName: purchase_line
            columns:
              - column:
                  name: invoice_id
                  type: varchar(255)
                  constraints:
                    primaryKey: true
              - column:
                  name: item_code
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: item_code_type
                  type: varchar(10)
                  constraints:
                    nullable: false
              - column:
                  name: item_description
                  type: varchar(255)
                  constraints:
                    nullable: false                    
              - column: 
                  name: quantity
                  type: number
                  constraints:
                      nullable: false
              - column:
                  name: number
                  type: number
                  constraints:
                    primaryKey: true
              - column:
                  name: tax_rate
                  type: decimal
                  constraints:
                    nullable: false
              - column:
                  name: total_price
                  type: decimal
                  constraints:
                    nullable: false
              - column:
                  name: unit_of_measure_description
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: unit_price
                  type: decimal
                  constraints:
                    nullable: false
        - createTable:
            tableName: invoice
            columns:
              - column:
                    name: cedente_prestatore_code
                    type: varchar(255)
                    constraints:
                      nullable: false
              - column:
                    name: cedente_prestatore_country_code
                    type: varchar(8)
                    constraints:
                      nullable: false
              - column:
                    name: cessionario_committente_code
                    type: varchar(255)
                    constraints:
                      nullable: false
              - column:
                    name: cessionario_committente_country_code
                    type: varchar(8)
                    constraints:
                      nullable: false
              - column:
                    name: currency
                    type: varchar(8)
                    constraints:
                      nullable: false
              - column:
                    name: date
                    type: dateTime
                    constraints:
                      nullable: false
              - column:
                    name: description
                    type: varchar(1024)
                    constraints:
                      nullable: false
              - column:
                    name: discount_amount
                    type: decimal
              - column:
                    name: discount_type
                    type: varchar(20)
              - column:
                    name: discount_type_code
                    type: varchar(10)
              - column:
                    name: document_type_code
                    type: varchar(10)
                    constraints:
                      nullable: false
              - column:
                    name: financial_institution_id
                    type: varchar(255)
                    constraints:
                      foreignKeyName: fk_financial_institution_invoice
                      nullable: false
                      references: financial_institution(iban)
              - column:
                    name: invoice_recipient_code
                    type: varchar(50)
                    constraints:
                      nullable: false
              - column:
                    name: invoice_sender_code
                    type: varchar(255)
                    constraints:
                      nullable: false
              - column:
                    name: invoice_sender_country_code
                    type: varchar(8)
                    constraints:
                      nullable: false
              - column:
                    name: invoice_sender_email_address
                    type: varchar(255)
                    constraints:
                      nullable: false
              - column:
                    name: invoice_sending_format
                    type: varchar(50)
                    constraints:
                      nullable: false
              - column:
                    name: invoice_sending_number
                    type: varchar(50)
                    constraints:
                      nullable: false
              - column:
                    name: number
                    type: varchar(255)
                    constraints:
                      primaryKey: true
              - column:
                    name: payment_amount
                    type: decimal
                    constraints:
                      nullable: false
              - column:
                    name: payment_conditions
                    type: varchar(10)
                    constraints:
                      nullable: false
              - column:
                    name: payment_expiration_date
                    type: dateTime
                    constraints:
                      nullable: false
              - column:
                    name: payment_mode
                    type: varchar(10)
                    constraints:
                      nullable: false
              - column:
                    name: payment_term_days
                    type: number
                    constraints:
                      nullable: false
              - column:
                    name: soggetto_emittente
                    type: varchar(8)
                    constraints:
                      nullable: false
              - column:
                    name: soggetto_emittente_name
                    type: varchar(255)
                    constraints:
                      nullable: false
              - column:
                    name: stamp_amount
                    type: decimal
                    constraints:
                      nullable: false
              - column:
                    name: taxable_amount
                    type: decimal
                    constraints:
                      nullable: false
              - column:
                    name: tax_due
                    type: varchar(10)
                    constraints:
                      nullable: false
              - column:
                    name: tax_law_reference
                    type: varchar(255)
                    constraints:
                      nullable: false
              - column:
                    name: tax_rate
                    type: decimal
                    constraints:
                      nullable: false
              - column:
                    name: total_amount
                    type: decimal
                    constraints:
                      nullable: false
              - column:
                    name: transport_document_date
                    type: dateTime
                    constraints:
                      nullable: false
              - column:
                    name: transport_document_id
                    type: varchar(20)
                    constraints:
                      nullable: false
              - column:
                    name: version
                    type: varchar(255)
                    constraints:
                      foreignKeyName: fk_invoice_version_invoice
                      nullable: false
                      references: invoice_version(version)
              - column:
                    name: virtual_stamp
                    type: integer
        - createTable:
            tableName: invoice_participant
            columns:
            - column:
                  name: city
                  type: varchar(50)
                  constraints:
                    nullable: false
            - column:
                  name: code
                  type: varchar(255)
                  constraints:
                    primaryKey: true
            - column:
                  name: country
                  type: varchar(30)
                  constraints:
                    nullable: false
            - column:
                  name: country_code
                  type: varchar(8)
                  constraints:
                    primaryKey: true
            - column:
                  name: district
                  type: varchar(30)
                  constraints:
                    nullable: false
            - column:
                  name: email_address
                  type: varchar(255)
            - column:
                  name: name
                  type: varchar(255)
                  constraints:
                    nullable: false
            - column:
                  name: phone_number
                  type: varchar(255)
            - column:
                  name: social_security_number
                  type: varchar(255)
                  constraints:
                    nullable: false
            - column:
                  name: street_address
                  type: varchar(255)
                  constraints:
                    nullable: false
            - column:
                  name: zip_code
                  type: varchar(10)
                  constraints:
                    nullable: false
        - createTable:
            tableName: invoice_cedente_prestatore
            columns:
            - column:
                  name: clearance_state
                  type: varchar(10)
                  constraints:
                    nullable: false
            - column:
                  name: code
                  type: varchar(255)
                  constraints:
                    primaryKey: true
            - column:
                  name: country_code
                  type: varchar(8)
                  constraints:
                    primaryKey: true
            - column:
                  name: rea_number
                  type: varchar(30)
                  constraints:
                    nullable: false
            - column:
                  name: rea_office
                  type: varchar(255)
                  constraints:
                    nullable: false
            - column:
                  name: share_capital
                  type: decimal
                  constraints:
                    nullable: false
            - column:
                  name: sole_stakeholder
                  type: varchar(10)
                  constraints:
                    nullable: false
            - column:
                  name: tax_system
                  type: varchar(20)
                  constraints:
                    nullable: false
        - createTable:
            tableName: linked_invoice
            columns:
            - column:
                  name: date
                  type: dateTime
                  constraints:
                    nullable: false
            - column:
                  name: id
                  type: varchar(255)
                  constraints:
                    nullable: false
            - column:
                  name: invoice_id
                  type: varchar(255)
                  constraints:
                      foreignKeyName: fk_linked_invoice_invoice
                      nullable: false
                      references: invoice(number)
        - createTable:
            tableName: purchase_order
            columns:
            - column:
                  name: cig_code
                  type: varchar(50)
            - column:
                  name: date
                  type: dateTime
                  constraints:
                    primaryKey: true
            - column:
                  name: id
                  type: varchar(255)
                  constraints:
                    primaryKey: true
            - column:
                  name: invoice_id
                  type: varchar(255)
                  constraints:
                      foreignKeyName: fk_purchase_order_invoice
                      nullable: false
                      references: invoice(number)
            - column:
                  name: purchase_line_invoice_id
                  type: varchar(255)
            - column:
                  name: purchase_line_number
                  type: varchar(255)
        - addForeignKeyConstraint:
            baseColumnNames: code,country_code
            baseTableName: invoice_cedente_prestatore
            constraintName: fk_invoice_participant_invoice_cedente_prestatore
            referencedColumnNames: code,country_code
            referencedTableName: invoice_participant
        - addForeignKeyConstraint:
            baseColumnNames: cedente_prestatore_code,cedente_prestatore_country_code
            baseTableName: invoice
            constraintName: fk_invoice_invoice_cedente_prestatore
            referencedColumnNames: code,country_code
            referencedTableName: invoice_cedente_prestatore
        - addForeignKeyConstraint:
            baseColumnNames: cessionario_committente_code,cessionario_committente_country_code
            baseTableName: invoice
            constraintName: fk_invoice_invoice_cessionario_committente
            referencedColumnNames: code,country_code
            referencedTableName: invoice_participant
        - addForeignKeyConstraint:
            baseColumnNames: invoice_id
            baseTableName: purchase_line
            constraintName: fk_purchase_line_invoice
            referencedColumnNames: number
            referencedTableName: invoice
        - addForeignKeyConstraint:
            baseColumnNames: purchase_line_invoice_id,purchase_line_number
            baseTableName: purchase_order
            constraintName: fk_purchase_order_purchase_line
            referencedColumnNames: invoice_id,number
            referencedTableName: purchase_line
